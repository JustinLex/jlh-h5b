apiVersion: argoproj.io/v1alpha1
kind: Application
metadata:
  name: onepassword-helm

  annotations:
    kubernetes.io/description: |
      This Application installs the 1password operator, 
      used for fetching secrets from 1password and distributing them throughout my homelab.
      
      Note that this operator needs 2 secrets in the onepassword namespace, one named "op-credentials", and one named "onepassword-token".
      These should be created by hand through kubectl, as they are generated by 1password, and they are the root credentials giving access to 1password.
            
      This application points to the 1password Helm repo.
      To update 1password to a new major or minor release, change the targetRevision tag to a new release tag.
      https://argo-cd.readthedocs.io/en/stable/user-guide/trackin g_strategies/#helm
    jlh.name/upstream: https://github.com/1Password/connect-helm-charts/tree/main/charts/connect
spec:
  project: default
  source:
    chart: connect
    repoURL: https://1password.github.io/connect-helm-charts
    targetRevision: 1.10.*
    helm:
      releaseName: connect
      parameters:
        - name: "operator.create"
          value: "true"
  destination:
    name: in-cluster
    namespace: 'onepassword'
  syncPolicy:
    automated: {}
    syncOptions:
      - CreateNamespace=true
